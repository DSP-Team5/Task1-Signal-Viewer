<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Signal Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    

    <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=KbhAsM2_isPQNWwMXy2rEPQO_q72g03Y7BFiT4lNBA-DciRbfwsHhNW6WNOP_WUUUKI4-V8bb38EcNdHxNMFcvzF3EhWHB6QPxbZ9rTC2zPdraMeE7iRVxxXG-OX9cPVIaVV48JOBATnHIfBhcnmCFliyxIENL2TSkHMGTzm7aRNOQ-EopSVnWbireKgOzN8XfiMOJVkVCrqqlbJWRePa9G6GPzPbzr8yAenGF64op4thoaHlnTWWDYeRosTz5ngHjkBqTjx7XaX9YhCNhIVOPmiix8-7ZhHXItUX9QrFoM9SNDSr_xBpHKb9vSa0SG-4X7rPJTkq2zrjMeIzVFCOCHnGpiuDlo6ohO3mSQylfdt0SUrRoV_zWLcQvMXI1HpuiVs9nCDrl28Tqto5jECfk3jVsfivr_CnSc4gOE8YKxk3Hh6g_FMYr4rm-mMOfjNWM2-IKgkwc_WJS4hU4fpXMAF5UG-B3r2uk-1ZN4CEBReyWOPhLRHMBX-WCGU8hPxWCbwre23sxw5HTIDy-_m_4Eb5FM3fFdY83U3HrKxKxmW3cysIbpLrO0pHHjQjWqaosJZxNa9kDiyzERBlSeFPbZI7xRTKTrPFZPuvCE6JcPuFhBiIppXZFA_5HFDx4Z3IyE_eXdmOGFATJPob_8XME_L0EAzhhZ_54cPBCJhe0FDROVWXCwKZH2Rs6i5ZlBhqN6bzCfZ10gPHP9e5dnlEwtFAWDnRU4AEkmxvty2hRmjuEMd2ykP9i3OQORxzmtLdM6SRlnfCmNVpmxP_OX9VJ8q76_ELxviGegWwbBtAy3N-c_y9MzOaiYHoJm84Y6HL5RBukUi5QZaI2IFGUOD39gSx8q0wzK1aeePQqNBhoXHlzeFxfUzEEz8JnuHsHgcPTZlRT5A7A-88Q_9rvTRvetiYdJi4hfNO7SUkFE-fGGd1WRyIeT13mDuG3WCvfpfAsn7MqYCKRGN7Q6RZCY7kG0Q0-v_O-SXVbyZfRAIq-QMXAeQqe2akUTm06feO2MbJmPs1kURXslkBHjXjA5kqA7tLN_zvCitMneF_6fHaGgZ-isBFhdv54zyXx1KQbTqk38t1SaVbnpmDRwId3fiTuRlXt86BERTmWueFkGg_hwBPJy2pnv9-9Pp6AmVzHU0OYAF2QASvAar6SElYTe3vJsmscmNqcWm8rRZtUCIVfoPhzWcwqclPODP-A6JeC3Vb-uHtL3y9aBSlf-HExp0sbvlXELxeUGXCWTV3bgfcze0tQh4z6lyE8P7qGqEKR2cuzI1z_SgErUHrLdJLvy3-HU8QsprlxHP54ZiIx6JMP7q4t4mfV5NjufhxV3OS4y688dk7mu4sFKkTEGxTsIsJZH0gotKI72IT0lKAYlIR40w8PcC7hZ-z62nP1tQWgLCEB2LliW7c5JhNWD4uXaOiZs4EhVL8d0Sw65-35HDFs0ajMK1snwL1uUhZOeMQQ6y0gnC06T1XZc9I4nTGFJLCRmfx8SshGYpG0Yw33KaijA0SniO5PzLhPYUwIYqWLasKuhrw802fFFxH_ZyADvaU6-JHpcOBwQ3l7vz5W6U9GUIyKBZy_oFu9zo-WGZLX28IUKIduSFjIYhLI4VrI9LoZFhUdHva5VL81Sm7uwYUen-WTphlnAz32LbeCj-r7AK" nonce="09b3cdcc67edae321ae8e4fdc78d3a36" charset="UTF-8"></script><link rel="stylesheet" crossorigin="anonymous" href="https://gc.kis.v2.scr.kaspersky-labs.com/E3E8934C-235A-4B0E-825A-35A08381A191/abn/main.css?attr=aHR0cHM6Ly9tYWlsLWF0dGFjaG1lbnQuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2F0dGFjaG1lbnQvdS8wLz91aT0yJmlrPTFhZjJlMDIzM2UmYXR0aWQ9MC4xJnBlcm1tc2dpZD1tc2ctZjoxNzYxODk4ODM2NjQ1NjIyNTc5JnRoPTE4NzM4NWE4MzA2ZmIzMzMmdmlldz1hdHQmZGlzcD1zYWZlJnJlYWxhdHRpZD1mX2xmd3B3emg4MCZzYWRkYmF0PUFOR2pkSi1US1RrTDBFWWxCZG1NR0VvSF9PclBDVGUxU2UybWhVUWpVdUFTTXNHY3hGUGgxVDNiRElOcmkwNXgzS1pZdjJ2OUlacF80Vk05ZzNhVDJxd1N1R1h1Zlg0WUYyM1BUbThrZ1JianBPTmNyZEZTbGZVR1RQMk1RQXlIUExtRmVrY0RaMTczWUdzTm9Rc2FjRXpPU3FEbHZjckJSRG5HVjhLbVRuNmJ3eXlrRGdGX2lQVURUaUFxNUtSMTNLQzQ1cE0zV1VEVXpGNTROZHFvNXB3MDVSUGdLcmhZcExOUEVpUl9kZmNUV05kbWVQR1BPSkFScm0zcEdqeGRZNkNpamdHQkhzV216R3JlLUkwYnczOEQ4OU1fRnBMNXhlYkVpOE5ORXhQSVAwZ3l5NHJPaHlwelpidUJpN0h6OWlOWEp5aHM3b0NxYVJqN2dFaERTT2w1cl9vVDlmT1dnalFKVnVVTllGSG5lRTR5clhPOUpreVVhZUNEUWloejBhR1pxT2wtNVBEanppYzNtVzhTcnFMajZtR0VIUEdWaUxQckJLeUs4amZKVTRuRzF1U3ZoOEM3ek1PSjkzTWV4TzdTbmVGR1ExSnVTdWxHUjdKYS1VT1YxQ3p3cEdRNU5JRWtJcXpieFlyNlI1SzRRcjJfcXdnMElBVFg5UFhVbVVic1p0UjhkRndDbjNkMnNmVFR3NzZEY2ZwR1BGVzhfZEt3R18yYWRUOXpka1M2VW9Ga0hnLXpQYVcwSUNRa1NYQUREMnJQWmZ2NU9vd3NIdUllMldCXzlfWnJQM1cwZ3NldHZuNUxMWHNrMks4N1ZvbUExWEpab0FkWnZ2cGI5WUNkTVZWTFZVOFUzTFJUOFRvOHRFWVhJeU1WemFKOUhJR2ZuUnl1UllxTGpyNnBhZzBhUEJhWGNJdGV4RGpwZ1dxX3p5TzdJQlpFVUV1aXVqSk4tUlJVSXpXV05Hd180QlVXSGJmeWphbTV3R0Q4ZDA1NUYwVzkwSjJQVFRwSHNKeFdDdXpLdTY5Z1JWZ25XeWNSOEpnNDhGQm83d1ZwUXdnV3lTbTRDbm9QRmhSa2hvUzVWNzdJSkk3bXV6WklydEI1U283bWJGbE1hQV92OEhkbWZUeWNpU2V2dDAwN1A3eFVIYzZPbXE4Z2tCdUZTRlE5Q0UwakE1RFNkOHltYVN2NzNlTEtVekFJY1ROSUNMYk9CLVFOUmxXVVZuTnhYZ3J3ejhmaEFES2VXTGNUY05XWVdIMHNNWnZ5THMyaTVta0xsa09VOTFzOEx4UjF2dGw0c25kQzZEazh1Tm1KZjRxRkJENEFKR2h0X1huWXhlN0hpMV9wMjdrSzVfSQ"/><script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.70/vfs_fonts.js"></script>
    <script src="./jsPDF-1.3.2/jspdf.js"></script>
    <link rel="stylesheet" href="style.css">
    
  </head>
  
  <body style="height:500px" >
    

    <!-----------------------------NAVBAR --------------------------------------->
    <nav class="navbar fixed-top navbar-expand-md navbar-light bg-bg-secondary.bg-gradient "style="background-color: rgba(122, 206, 255, 0.227);">
      
      <div class="container" >
        
        <a 
          href="index.html" 
          class="navbar-brand mb-0 h1">
            <img 
            class="d-inline-block aligh-top"
            src="logo.PNG" width="100" height="50" />
            Digital Signals
        </a>

        <button
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
        class="navbar-toggler"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon">

          </span>
        </button>


        <div 
          class="collapse navbar-collapse" 
          id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item active">
                <a href="index.html" class="nav-link ">
                    Home
                </a>
            </li>
            <li class="nav-item active">
                <a href="view.html" class="nav-link">
                    Signal Viewer
                </a>
            </li>
            <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle"
                id="navbarDropdown" role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
                >
                    Contact
                </a>
                <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                    <li><a href="https://www.wikihow.com/Send-an-Email-Using-Gmail" class="dropdown-item"> Email </a></li>
                    <li><a href="https://randommer.io/Phone" class="dropdown-item"> Phone </a></li>

                </ul>
            </li>
            <li class="nav-item active">
                <a href="https://www.google.com" class="nav-link">
                    About us
                </a>
            </li>
          </ul>

        </div>
      </div>
    </nav>

    <br/>
    <br/>
    <br/>
    <br/>


    <!----------------------------CONTAINER------------------------------------>
    <div class="container" id="input" style="background-color: rgba(122, 206, 255, 0.227);">
        

      <div class="mb-3">
        <label for="formFile" class="form-label"><h6> Input Signal</h6> </label>
        
      
      <!----------------------------------GRAPHS------------------------------->

      <div id="block1">
        <input type="file" id="fileInput" accept=".csv">

        <div class="btn1"><button onclick="play()">
          <img id = "play" alt = "Play" src="./icons/icons8-spielen-50.png" width="20" height="20"></img>
        </button></div>
        <button onclick="rewind()">
          <img src="./icons/icons8-zurückspulen-30.png" width="20" height="20"></img>
        </button>
        <input type="range" id="speedSlider1" min="400" max="700" value="550">
        <input type="color" id="graph1Color" value="#0000ff">
        <button id="graph1Show">
          <img id="showHide1" src="./icons/icons8-sichtbar-24.png" width="20" height="20"></img>
        </button>
        <button  id="generate-pdf-1">
          <img src="./icons/icons8-pdf-50.png" width="20" height="20">Generate PDF</img>
        </button>
        
        <div> <input type="text" id="graph1Label" />
            
            <button id="addGraph1Label">
              <img src="./icons/icons8-preisschild-50.png" width="20" height="20">Add Label</img>
            </button>
        </div>
    </div>
      <div id="graph1" ></div>
    
  
    <div>
      <img src="./icons/icons8-link-50.png" width="20" height="20"></img>
      <label for="link" id="link_lbl">Link</label>
      <input type="checkbox" id="link">
    </div>
    <div id="block2">
      <input type="file" id="fileInput2" accept=".csv">

      <button onclick="play2()">
        <img id = "play2" src="./icons/icons8-spielen-50.png" width="20" height="20"></img>
      </button>
      <button onclick="rewind2()">
        <img src="./icons/icons8-zurückspulen-30.png" width="20" height="20"></img>
      </button>
      <input type="range" id="speedSlider2" min="400" max="700" value="550">
      <input type="color" id="graph2Color" value="#0000ff">
      <button id="graph2Show">
        <img id = "showHide2" src="./icons/icons8-sichtbar-24.png" width="20" height="20"></img>
      </button>
      <button id="generate-pdf-2">
        <img src="./icons/icons8-pdf-50.png" width="20" height="20">Generate PDF</img>
      </button>
      
      <div> <input type="text" id="graph2Label" />
          
          <button id="addGraph2Label">
            <img src="./icons/icons8-preisschild-50.png" width="20" height="20">Add Label</img>
          </button>

        </div>
    </div>
    <div>
        <div id="graph2"></div>
    </div>

  </div>
      

      <!-----------------------------script-------------------------------------->
      <script>
        var x = [];
        var y = [];
        var x2 = [];
        var y2 = [];
        var playing1 = false;
        var playing2 = false;
        var currentPointer1 = 0;
        var currentPointer2 = 0;

        var data1 = [{ x: [], y: [], mode: 'lines', line: { color: 'blue', width: 2 } }];
        var data2 = [{ x: [], y: [], mode: 'lines', line: { color: 'red', width: 2 } }];
        var limit = 100; // maximum number of data points to show on the plot
        var pointer1 = 0;
        var pointer2 = 0; // index of the next data point to add to the plot
        let graph1Visible = true;
        let graph2Visible = true;



        // ___________________________________________ READING FILES ___________________________________________


        Plotly.newPlot('graph1', data1, {title: {text: ''}});
        Plotly.newPlot('graph2', data2, {title: {text: ''}});

        function readFile1(event) {
            
            
            
            var input = event.target;
            var reader = new FileReader();
            reader.onload = function () {
                var text = reader.result;
                var rows = text.split('\n');
                for (var i = 0; i < rows.length; i++) {
                    var columns = rows[i].split(',');
                    if (columns.length == 2) {
                        x.push(parseFloat(columns[0]));
                        y.push(parseFloat(columns[1]));
                    }
                }
                updatePlot1();
                
            };
            reader.readAsText(input.files[0]);
        }




        function readFile2(event) {
            
            
            var input = event.target;
            var reader = new FileReader();
            reader.onload = function () {
                var text = reader.result;
                var rows = text.split('\n');
                for (var i = 0; i < rows.length; i++) {
                    var columns = rows[i].split(',');
                    if (columns.length == 2) {
                        x2.push(parseFloat(columns[0]));
                        y2.push(parseFloat(columns[1]));
                    }
                }
                updatePlot2();
            };
            reader.readAsText(input.files[0]);
        }





// ___________________________________________ ADDING LABELS___________________________________________

function addLabel1() {
  var label1 = document.getElementById("graph1Label").value.toString();
    Plotly.relayout('graph1', {title: {text: label1}})

}
document.getElementById("addGraph1Label").addEventListener("click", addLabel1);

function addLabel2() {
  var label2 = document.getElementById("graph2Label").value.toString();
  Plotly.relayout('graph2', {title: {text: label2}})
}
document.getElementById("addGraph2Label").addEventListener("click", addLabel2);


// ___________________________________________ UPDATING PLOT 1 & 2 ___________________________________________

var plotData1 = [];
var latestGraph1Image='';
var graphDiv = document.getElementById('graph1');
var graphLayout = graphDiv._fullLayout;
var graphWidth = graphDiv.offsetWidth || graphLayout.width || 800;
var graphHeight = graphDiv.offsetHeight || graphLayout.height || 600;



function updatePlot1() {
  if (playing1) {
    if (currentPointer1 < x.length && currentPointer1 >= length) {
  // console.log(currentPointer1, x.length);
  var graph1Color = document.getElementById('graph1Color').value;
  data1[0].line.color = graph1Color;
  var update1 = {
    x: [[x[currentPointer1]]],
    y: [[y[currentPointer1]]]
  };

  // console.log(update1.x[0], update1.y[0])
  
  Plotly.extendTraces('graph1', update1, [0]);
  plotData1.push({ x: x[currentPointer1], y: y[currentPointer1] });

  // move the pointer to the next data point
  currentPointer1 = currentPointer1 + 1;

  // update the layout of the plot to enable scrolling
  Plotly.relayout('graph1', { 'xaxis.range': [data1[0].x[Math.max(0, data1[0].x.length - limit)], data1[0].x[data1[0].x.length - 1]] });
  
}
  
  else{
    // console.log(currentPointer1 < x.length && currentPointer1 >= length)
    rewind();
  currentPointer1 = 0;
}
  }




  Plotly.toImage('graph1', { format: 'png', width: graphWidth, height: graphHeight, margin: { l: 50, r: 50, t: 50, b: 50 } })
    .then(function (imgData) {
      latestGraph1Image = imgData;
    })
    .catch(function (err) {
      console.error(err);
    });


  var speedSlider1 = document.getElementById('speedSlider1');
  var delayTime1 = 500 - speedSlider1.value;
  // schedule the next update
  setTimeout(updatePlot1, delayTime1);


}


var plotData2 = [];
var latestGraph2Image='';
var graph2Div = document.getElementById('graph2');
var graph2Layout = graph2Div._fullLayout;
var graph2Width = graph2Div.offsetWidth || graph2Layout.width || 800;
var graph2Height = graph2Div.offsetHeight || graph2Layout.height || 600;

function updatePlot2() {
  if (playing2) {
    if (currentPointer2 < x2.length  && currentPointer2 >= length) {
      console.log(currentPointer2, x2.length);
    // add the next data point to the plot
    var graph2Color = document.getElementById('graph2Color').value;
    data2[0].line.color = graph2Color;
    var update2 = {
      x: [[x2[currentPointer2]]],
      y: [[y2[currentPointer2]]]
    };

    console.log(update2.x[0], update2.y[0])
    Plotly.extendTraces('graph2', update2, [0]);
    plotData2.push({ x: x2[currentPointer2], y: y2[currentPointer2] });

    // move the pointer to the next data point
    currentPointer2 = currentPointer2 + 1;

    // update the layout of the plot to enable scrolling
    Plotly.relayout('graph2', { 'xaxis.range': [data2[0].x[Math.max(0, data2[0].x.length - limit)], data2[0].x[data2[0].x.length - 1]] });
  }

  else{
    console.log(currentPointer2 < x2.length && currentPointer2 >= length)
    rewind2();
  currentPointer2 = 0;
}
  }




  Plotly.toImage('graph2', { format: 'png', width: graph2Width, height: graph2Height, margin: { l: 50, r: 50, t: 50, b: 50 } })
    .then(function (imgData) {
      latestGraph2Image = imgData;
    })
    .catch(function (err) {
      console.error(err);
    });


  var speedSlider2 = document.getElementById('speedSlider2');
  var delayTime2 = 500 - speedSlider2.value;
  // schedule the next update
  setTimeout(updatePlot2, delayTime2);
}

// _______________________________________________________________________________________________________________________



const playPauseIcon1 = document.getElementById('play');
const playPauseIcon2 = document.getElementById('play2');
const showHideIcon1 = document.getElementById('showHide1');
const showHideIcon2 = document.getElementById('showHide2');
        
        function play() {
          if (playing1==true ) {
            playing1 = false;
            playPauseIcon1.src = './icons/icons8-spielen-50.png';
          }
          else{
            playing1 = true;
            playPauseIcon1.src = './icons/icons8-pause-30.png';
          }
        }
    // Pause the playback

            

        function rewind() {
            data1[0].x = [];
            data1[0].y = [];
            currentPointer1 = 0;
            Plotly.newPlot('graph1', data1);
        }
        function play2() {
          if (playing2==true ) {
            playing2 = false;
            playPauseIcon2.src = './icons/icons8-spielen-50.png';
          }
          else{
            playing2 = true;
            playPauseIcon2.src = './icons/icons8-pause-30.png';
          }
        }

        function rewind2() {
            data2[0].x = [];
            data2[0].y = [];
            currentPointer2 = 0;
            Plotly.newPlot('graph2', data2);
        }

        





        function updateSpeed1() {
            var speedSlider1 = document.getElementById('speedSlider1');
            speed1 = 101 - parseInt(speedSlider1.value);
        }

        function updateSpeed2() {
            var speedSlider2 = document.getElementById('speedSlider2');
            speed2 = 101 - parseInt(speedSlider2.value);
        }
        function updatePlotColor1(plot, color) {
            var update = {
                'line.color': color
            };
            // Plotly.update(plot, update);
        }
        function updatePlotColor2(plot, color) {
            var update = {
                'line.color': color
            };
            // Plotly.update(plot, update);
        }
        // Add show/hide buttons for each graph
        const graph1ShowButton = document.getElementById("graph1Show");
        graph1ShowButton.addEventListener("click", function () {
          if (graph1Visible==true) {
            graph1Visible = false;
            Plotly.restyle(graph1, { visible: false }, [0]);
            showHideIcon1.src = './icons/icons8-ausblenden-30.png';
          }
            else {
              graph1Visible = true;
            Plotly.restyle(graph1, { visible: true }, [0]);
            showHideIcon1.src = './icons/icons8-sichtbar-24.png';
            }
          }
            
        );

        const graph2ShowButton = document.getElementById("graph2Show");
        graph2ShowButton.addEventListener("click", function () {
          if (graph2Visible==true) {
            graph2Visible = false;
            Plotly.restyle(graph2, { visible: false }, [0]);
            showHideIcon2.src = './icons/icons8-ausblenden-30.png';
          }
            else {
              graph2Visible = true;
            Plotly.restyle(graph2, { visible: true }, [0]);
            showHideIcon2.src = './icons/icons8-sichtbar-24.png';
            }
          }
            
        );










        function dataURItoBlob(dataURI) {
  var byteString = atob(dataURI.split(',')[1]);
  var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
  var ab = new ArrayBuffer(byteString.length);
  var ia = new Uint8Array(ab);
  for (var i = 0; i < byteString.length; i++) {
    ia[i] = byteString.charCodeAt(i);
  }
  return new Blob([ab], { type: mimeString });
}








function generatePDF(data, statistics, image) {
  statistics.minimum = statistics.minimum.toFixed(2);
  statistics.maximum = statistics.maximum.toFixed(2);
  statistics.mean = statistics.mean.toFixed(2);
  statistics.standardDeviation = statistics.standardDeviation.toFixed(2);
  statistics.duration = statistics.duration.toFixed(2);
  // create a new document
  var docDefinition = {
    content: [
      // add the graph image
      {
        image: image,
        width: 500
      },

      // add the statistics table
      {
        table: {
          widths: ['*', '*'],
          body: [
            ['Minimum', statistics.minimum],
            ['Maximum', statistics.maximum],
            ['Mean', statistics.mean],
            ['Standard Deviation', statistics.standardDeviation],
            ['Duration', statistics.duration]
          ]
        }
      }
    ]
  };

  // generate the PDF
  pdfMake.createPdf(docDefinition).download();
}

document.getElementById('generate-pdf-1').addEventListener('click', function () {
  // get the data and statistics for the graph
  var data = plotData1.map(function (d) { return d.y; });
  var mean = data.reduce((a, b) => a + b, 0) / data.length;
  var standardDeviation = Math.sqrt(data.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / data.length);
  var statistics = {
    minimum: Math.min(...data),
    maximum: Math.max(...data),
    mean: mean,
    standardDeviation: standardDeviation,
    duration: data.length / 1000 // assuming data is sampled at 1000 Hz
  };

  // generate the PDF
  generatePDF(data, statistics, latestGraph1Image);
});



document.getElementById('generate-pdf-2').addEventListener('click', function () {
  // get the data and statistics for the graph
  var data = plotData2.map(function (d) { return d.y; });
  var mean = data.reduce((a, b) => a + b, 0) / data.length;
  var standardDeviation = Math.sqrt(data.reduce((a, b) => a + Math.pow(b - mean, 2), 0) / data.length);
  var statistics = {
    minimum: Math.min(...data),
    maximum: Math.max(...data),
    mean: mean,
    standardDeviation: standardDeviation,
    duration: data.length / 1000 // assuming data is sampled at 1000 Hz
  };

  // generate the PDF
  generatePDF(data, statistics, latestGraph2Image);
});









        
        //Link function
        const link = document.getElementById('link');
var linked = false;

link.addEventListener('change', (event) => {
    if (event.currentTarget.checked) {
        linked = true;
        playing1 = false;
        i = 0;
        updatePlot1();

        speedSlider1.value = speedSlider1.defaultValue; //returns to its deafult value
        cinespeed = speedSlider2.defaultValue;

        Plotly.redraw(graph1);
        play(); // restart the animation

        if (linked) {
            data2 = data1; // use the same data for both plots
        }

        playing2 = false;
        j = 0;
        updatePlot2();

        

        speedSlider2.value = speedSlider2.defaultValue; //returns to its deafult value
        cinespeed2 = cinespeed

        Plotly.redraw(graph2);
        play2(); // restart the animation



        //define a flag to avoid infinite loop
        let isRelayouting = false;



        // Link plot1 to plot2
        graph1.on('plotly_relayout', function (eventData) {
            if (linked && !isRelayouting) {
                isRelayouting = true;
                Plotly.relayout(graph2, eventData)
                    .then(() => {
                        isRelayouting = false;
                    });
            }
        });

        // Link plot2 to plot1
        graph2.on('plotly_relayout', function (eventData) {
            if (linked && !isRelayouting) {
                isRelayouting = true;
                Plotly.relayout(graph1, eventData)
                    .then(() => {
                        isRelayouting = false;
                    });
            }
        });



    }
    else {
        linked = false;
    }
});



        document.getElementById('fileInput').addEventListener('change', readFile1);
        document.getElementById('fileInput2').addEventListener('change', readFile2);
        document.getElementById('speedSlider1').addEventListener('input', updateSpeed1);
        document.getElementById('speedSlider2').addEventListener('input', updateSpeed2);
        document.getElementById('graph1Color').addEventListener('input', updatePlotColor1);
        document.getElementById('graph2Color').addEventListener('input', updatePlotColor2);

    </script>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
  
  </body>

</html>